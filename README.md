# å·¥å·åˆ†é…ç³»ç»Ÿ (Employee ID Allocation System)

ä¸€ä¸ªåŸºäº Next.js å’Œ SQLite çš„å·¥å·åˆ†é…ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå·¥å·ç”³è¯·ã€é‡Šæ”¾ã€ç®¡ç†å‘˜ç®¡ç†å’Œå·¥å·æ± ç®¡ç†ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ç”¨æˆ·åŠŸèƒ½
- **å·¥å·ç”³è¯·**: ç”¨æˆ·å¯ä»¥ç‚¹å‡»"ç”³è¯·å·¥å·"æŒ‰é’®è·å–å¯ç”¨å·¥å·
- **å·¥å·é‡Šæ”¾**: ç”¨æˆ·å¯ä»¥ç‚¹å‡»"é‡Šæ”¾å·¥å·"æŒ‰é’®å½’è¿˜å·¥å·
- **å®æ—¶æ»šåŠ¨**: å·²åˆ†é…å·¥å·åˆ—è¡¨å®æ—¶æ»šåŠ¨æ˜¾ç¤ºï¼Œæ‚¬åœå¯æš‚åœ
- **IP è®°å½•**: ç³»ç»Ÿè®°å½•ç”¨æˆ·çš„ IP åœ°å€å’Œåˆ†é…æ—¶é—´
- **è‡ªåŠ¨è¿‡æœŸ**: å·¥å·åœ¨å½“å¤© 24:00 è‡ªåŠ¨é‡Šæ”¾
- **çŠ¶æ€ç»Ÿè®¡**: æ˜¾ç¤ºå·¥å·æ€»æ•°ã€å¯ç”¨ã€å·²åˆ†é…ã€å·²åœç”¨æ•°é‡

### ç®¡ç†å‘˜åŠŸèƒ½
- **ç®¡ç†å‘˜ç™»å½•**: å®‰å…¨çš„ç®¡ç†å‘˜ç™»å½•ç³»ç»Ÿï¼ˆé»˜è®¤å¯†ç : root123ï¼‰
- **å·¥å·ç®¡ç†**:
  - æŸ¥çœ‹æ‰€æœ‰å·¥å·çŠ¶æ€ï¼ˆå¯ç”¨/å·²åˆ†é…/å·²åœç”¨ï¼‰
  - å•ä¸ªå·¥å·æ·»åŠ ã€åˆ é™¤ã€å¯ç”¨ã€åœç”¨
  - æ‰¹é‡å¯¼å…¥å·¥å·ï¼ˆæ”¯æŒæ–‡æœ¬æ–‡ä»¶ï¼‰
  - æ‰¹é‡æ“ä½œï¼ˆå¯ç”¨ã€åœç”¨ã€åˆ é™¤ï¼‰
  - å·¥å·æœç´¢åŠŸèƒ½
- **å¯†ç ç®¡ç†**: ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
- **ä¼šè¯ç®¡ç†**: è‡ªåŠ¨ä¼šè¯éªŒè¯å’Œ 24 å°æ—¶è¿‡æœŸæ¸…ç†

## ğŸ“ é¡¹ç›®ç»“æ„

```
id-allocation-system/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ id-allocation/
â”‚   â”‚       â””â”€â”€ route.ts          # API è·¯ç”±ï¼ˆå‰åç«¯åˆ†ç¦»ï¼‰
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ AdminPanel.tsx        # ç®¡ç†å‘˜é¢æ¿ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ IdAllocationForm.tsx  # å·¥å·æ“ä½œè¡¨å•
â”‚   â”‚   â”œâ”€â”€ IdAllocationStatus.tsx # çŠ¶æ€æ˜¾ç¤ºç»„ä»¶
â”‚   â”‚   â””â”€â”€ IdAllocationList.tsx  # å·¥å·åˆ—è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useIdAllocation.ts    # å·¥å·åˆ†é… Hook
â”‚   â”œâ”€â”€ id-allocation-service.ts  # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚
â”‚   â”œâ”€â”€ db.ts                     # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ id-allocation-ui.tsx      # ä¸» UI ç»„ä»¶
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µ
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹å¸ƒå±€
â”‚   â””â”€â”€ globals.css               # å…¨å±€æ ·å¼ï¼ˆå«æ»šåŠ¨åŠ¨ç”»ï¼‰
â”œâ”€â”€ data/
â”‚   â””â”€â”€ employee_ids.db           # SQLite æ•°æ®åº“
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚
- Node.js 18+
- npm æˆ– pnpm

### å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ npm
npm install

# æˆ–ä½¿ç”¨ pnpm
pnpm install
```

### è¿è¡Œå¼€å‘æœåŠ¡å™¨

```bash
npm run dev
# æˆ–
pnpm dev
```

åº”ç”¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
npm start
```

## ğŸ”§ ä½¿ç”¨è¯´æ˜

### ç”¨æˆ·ä½¿ç”¨æµç¨‹
1. è®¿é—®ç³»ç»Ÿä¸»é¡µ `http://localhost:3000`
2. ç‚¹å‡»"**ç”³è¯·å·¥å·**"è·å–å·¥å·
3. å·¥å·å°†æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šæ–¹ï¼ˆè“è‰²å¡ç‰‡ï¼‰
4. ç‚¹å‡»"**é‡Šæ”¾å·¥å·**"å½’è¿˜å·¥å·
5. åœ¨æ»šåŠ¨åŒºåŸŸæŸ¥çœ‹æ‰€æœ‰å·²åˆ†é…å·¥å·ï¼ˆå« IP åœ°å€ï¼‰

### ç®¡ç†å‘˜ä½¿ç”¨æµç¨‹
1. åœ¨ä¸»é¡µç‚¹å‡»å³ä¸Šè§’"**ç®¡ç†å‘˜ç™»å½•**"
2. è¾“å…¥é»˜è®¤å¯†ç  `root123`
3. è¿›å…¥ç®¡ç†å‘˜é¢æ¿ï¼Œå¯ä»¥è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š

#### æŸ¥çœ‹å·¥å· (View IDs)
- æµè§ˆæ‰€æœ‰å·¥å·çŠ¶æ€ï¼ˆå¯ç”¨/å·²åˆ†é…/å·²åœç”¨ï¼‰
- æœç´¢å·¥å·
- é€‰ä¸­å¤šä¸ªå·¥å·è¿›è¡Œæ‰¹é‡æ“ä½œ
- æŸ¥çœ‹åˆ†é…æ—¶é—´ã€IP åœ°å€ã€è¿‡æœŸæ—¶é—´

#### æ‰¹é‡å¯¼å…¥ (Import)
- ä¸Šä¼  `.txt` æ–‡ä»¶å¯¼å…¥å·¥å·æ± 
- æ¯è¡Œä¸€ä¸ªå·¥å·ï¼Œè‡ªåŠ¨å»é‡
- æ˜¾ç¤ºå¯¼å…¥æˆåŠŸ/å¤±è´¥æ•°é‡å’Œé”™è¯¯è¯¦æƒ…

#### å•ä¸ªç®¡ç† (Manage)
- **æ·»åŠ å·¥å·**: è¾“å…¥å·¥å·æ•°å­—æ·»åŠ 
- **å¿«é€Ÿæ“ä½œ**: æ¸…ç©ºæ‰€æœ‰å·²åˆ†é…å·¥å·
- **å•ä¸ªæ“ä½œ**: å¯ç”¨ã€åœç”¨ã€åˆ é™¤å•ä¸ªå·¥å·

#### ä¿®æ”¹å¯†ç  (Password)
- è¾“å…¥æ—§å¯†ç å’Œæ–°å¯†ç 
- ç¡®è®¤åç«‹å³ç”Ÿæ•ˆ

### æ‰¹é‡å¯¼å…¥æ ¼å¼
åˆ›å»ºä¸€ä¸ª `.txt` æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªå·¥å·ï¼š
```
644100
644101
644102
644103
...
```

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### è¡¨ç»“æ„è¯´æ˜

**allocated_ids** - å·²åˆ†é…å·¥å·è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | å·¥å· (ä¸»é”®) |
| uniqueSessionId | TEXT | å”¯ä¸€ä¼šè¯ ID |
| allocationTime | TEXT | åˆ†é…æ—¶é—´ (ISO) |
| ipAddress | TEXT | åˆ†é…è€… IP |
| expiresAt | TEXT | è¿‡æœŸæ—¶é—´ (ISO) |

**employee_pool** - å‘˜å·¥å·¥å·æ± è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | å·¥å· (ä¸»é”®) |
| status | TEXT | çŠ¶æ€: available/allocated/disabled |
| createdAt | TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updatedAt | TIMESTAMP | æ›´æ–°æ—¶é—´ |

**passwords** - å¯†ç å­˜å‚¨è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| key | TEXT | å¯†é’¥ (ä¸»é”®) |
| value | TEXT | å¯†ç å€¼ |

**admin_sessions** - ç®¡ç†å‘˜ä¼šè¯è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| sessionId | TEXT | ä¼šè¯ ID (ä¸»é”®) |
| loginTime | TIMESTAMP | ç™»å½•æ—¶é—´ |
| lastActivity | TIMESTAMP | æœ€åæ´»åŠ¨æ—¶é—´ |

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **ä¼šè¯ç®¡ç†**: ç®¡ç†å‘˜æ“ä½œéœ€è¦æœ‰æ•ˆä¼šè¯ï¼ˆé€šè¿‡ HTTP Header `x-admin-session` ä¼ é€’ï¼‰
- **å¯†ç éªŒè¯**: å¯†ç åœ¨æ•°æ®åº“ä¸­å­˜å‚¨ï¼Œç™»å½•æ—¶éªŒè¯
- **è‡ªåŠ¨æ¸…ç†**:
  - è¿‡æœŸå·¥å·åœ¨æ¯æ¬¡ GET è¯·æ±‚æ—¶è‡ªåŠ¨æ¸…ç†
  - è¿‡æœŸä¼šè¯ï¼ˆ24 å°æ—¶ï¼‰åœ¨å¯åŠ¨æ—¶å’Œå®šæ—¶æ¸…ç†
- **æƒé™æ§åˆ¶**: æ•æ„Ÿæ“ä½œï¼ˆæ‰¹é‡å¯¼å…¥ã€åˆ é™¤ã€ä¿®æ”¹å¯†ç ç­‰ï¼‰éœ€è¦ç®¡ç†å‘˜è®¤è¯

## ğŸ¨ å‰ç«¯ä¼˜åŒ–

### æ»šåŠ¨æ˜¾ç¤º (å·²ç”³è¯·å·¥å·)
- **CSS åŠ¨ç”»**: 15ç§’å¾ªç¯æ»šåŠ¨ï¼Œæ— ç¼å¾ªç¯
- **æ‚¬åœæš‚åœ**: é¼ æ ‡æ‚¬åœæ—¶æš‚åœæ»šåŠ¨
- **å®æ—¶æ›´æ–°**: è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæœ€æ–°æ•°æ®
- **åŒå€å†…å®¹**: ç¡®ä¿æ»šåŠ¨æµç•…æ— é—ªçƒ

### çŠ¶æ€å¡ç‰‡
- **å·¥å·æ€»æ•°**: ç°è‰²å¡ç‰‡
- **å¯ç”¨å·¥å·**: ç»¿è‰²å¡ç‰‡
- **å·²åˆ†é…**: è“è‰²å¡ç‰‡
- **å·²åœç”¨**: æ©™è‰²å¡ç‰‡

### å“åº”å¼è®¾è®¡
- é€‚é…ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯
- æ¸…æ™°çš„çŠ¶æ€é¢œè‰²åŒºåˆ†
- ç›´è§‚çš„æ“ä½œç•Œé¢

## ğŸ”— API æ¥å£è¯¦è§£

### GET /api/id-allocation
è·å–å½“å‰ç³»ç»ŸçŠ¶æ€ï¼ˆæ— éœ€è®¤è¯ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "allocatedIds": [
    {"id": 644100, "ipAddress": "192.168.1.1"},
    {"id": 644101, "ipAddress": "192.168.1.2"}
  ],
  "totalPoolIds": 100,
  "availableIds": 50,
  "disabledIds": 5,
  "allocatedIdsCount": 45,
  "clientAllocatedId": 644100
}
```

### POST /api/id-allocation
æ“ä½œæ¥å£ï¼ˆæ ¹æ® Content-Type å’Œ action åŒºåˆ†ï¼‰

#### 1. ç”³è¯·å·¥å· (JSON)
```json
{ "action": "allocate", "forceNewAllocation": false }
```

#### 2. é‡Šæ”¾å·¥å· (JSON)
```json
{ "action": "release", "id": 644100 }
```

#### 3. ç®¡ç†å‘˜ç™»å½• (JSON)
```json
{ "action": "adminLogin", "password": "root123" }
```
**å“åº”**: `{ "success": true, "sessionId": "..." }`

#### 4. éªŒè¯ä¼šè¯ (JSON)
```json
{ "action": "verifySession" }
```
**Header**: `x-admin-session: <sessionId>`

#### 5. ä¿®æ”¹å¯†ç  (JSON)
```json
{ "action": "changePassword", "oldPassword": "...", "newPassword": "..." }
```
**Header**: `x-admin-session: <sessionId>`

#### 6. æ‰¹é‡å¯¼å…¥ (text/plain)
**Content-Type**: `text/plain`
**Body**:
```
644100
644101
644102
```
**Header**: `x-admin-session: <sessionId>`

#### 7. è·å–æ‰€æœ‰å·¥å· (JSON)
```json
{ "action": "getAllIds" }
```
**Header**: `x-admin-session: <sessionId>`

#### 8. è·å–ç»Ÿè®¡ (JSON)
```json
{ "action": "getPoolStats" }
```

#### 9. æ·»åŠ å•ä¸ªå·¥å· (JSON)
```json
{ "action": "addId", "id": 644100 }
```
**Header**: `x-admin-session: <sessionId>`

#### 10. åˆ é™¤å·¥å· (JSON)
```json
{ "action": "deleteId", "id": 644100 }
```
**Header**: `x-admin-session: <sessionId>`

#### 11. æ›´æ–°å·¥å·çŠ¶æ€ (JSON)
```json
{ "action": "updateIdStatus", "id": 644100, "status": "available" }
```
**Header**: `x-admin-session: <sessionId>`

#### 12. æ‰¹é‡æ“ä½œ (JSON)
```json
{ "action": "batchUpdate", "ids": [644100, 644101], "operation": "disable" }
```
**Header**: `x-admin-session: <sessionId>`
**operation**: `enable` | `disable` | `delete`

#### 13. æœç´¢å·¥å· (JSON)
```json
{ "action": "searchIds", "query": "64410", "status": "available" }
```
**Header**: `x-admin-session: <sessionId>`
**status**: å¯é€‰ï¼Œ`available` | `allocated` | `disabled`

#### 14. æ¸…ç©ºæ‰€æœ‰ (JSON)
```json
{ "action": "clearAll" }
```
**Header**: `x-admin-session: <sessionId>`

#### 15. ç™»å‡º (JSON)
```json
{ "action": "logout" }
```
**Header**: `x-admin-session: <sessionId>`

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| å‰ç«¯æ¡†æ¶ | Next.js | 15.2.0 |
| UI åº“ | React | 19.0.0 |
| è¯­è¨€ | TypeScript | 5.x |
| æ ·å¼ | Tailwind CSS | 3.4.1 |
| æ•°æ®åº“ | better-sqlite3 | 12.2.0 |
| å›¾æ ‡ | react-icons | 5.5.0 |
| å·¥å…· | uuid | 13.0.0 |

## ğŸ“ é»˜è®¤é…ç½®

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| ç®¡ç†å‘˜å¯†ç  | `root123` | å¯åœ¨ç®¡ç†å‘˜é¢æ¿ä¿®æ”¹ |
| æ•°æ®åº“ä½ç½® | `data/employee_ids.db` | è‡ªåŠ¨åˆ›å»º |
| å·¥å·è¿‡æœŸæ—¶é—´ | å½“å¤© 23:59:59 | è‡ªåŠ¨æ¸…ç† |
| ä¼šè¯è¿‡æœŸæ—¶é—´ | 24 å°æ—¶ | è‡ªåŠ¨æ¸…ç† |
| æ»šåŠ¨åŠ¨ç”»æ—¶é•¿ | 15ç§’ | å¯åœ¨ CSS ä¿®æ”¹ |
| è‡ªåŠ¨åˆ·æ–°é—´éš” | 10ç§’ | å¯åœ¨ Hook ä¿®æ”¹ |

## ğŸ”„ å¯åŠ¨æµç¨‹

ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š
1. åˆ›å»ºæ•°æ®ç›®å½• `data/`
2. åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
3. æ’å…¥é»˜è®¤ç®¡ç†å‘˜å¯†ç ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
4. æ¸…ç†è¿‡æœŸå·¥å·
5. æ¸…ç†è¿‡æœŸä¼šè¯
6. æ•°æ®åº“è¿ç§»ï¼ˆæ·»åŠ ç¼ºå¤±å­—æ®µï¼‰

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ•°æ®åº“é”™è¯¯
**åŸå› **: æ•°æ®åº“æ–‡ä»¶æƒé™é—®é¢˜
**è§£å†³**:
```bash
chmod 755 data/
chmod 644 data/employee_ids.db
```

### é—®é¢˜ï¼šä¾èµ–å®‰è£…å¤±è´¥
**åŸå› **: better-sqlite3 éœ€è¦ç¼–è¯‘
**è§£å†³**:
```bash
# Ubuntu/Debian
apt-get install build-essential python3

# CentOS/RHEL
yum install gcc-c++ make python3

# ç„¶åé‡æ–°å®‰è£…
npm install
```

### é—®é¢˜ï¼šç«¯å£å†²çª
**è§£å†³**: ä¿®æ”¹ `package.json`
```json
"scripts": {
  "dev": "next dev --port 3001"
}
```

### é—®é¢˜ï¼šç®¡ç†å‘˜ç™»å½•å¤±è´¥
**æ£€æŸ¥**:
1. ç¡®è®¤å¯†ç æ­£ç¡®ï¼ˆé»˜è®¤ root123ï¼‰
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

## ğŸ“¦ éƒ¨ç½²

### Docker éƒ¨ç½²
é¡¹ç›®åŒ…å« Docker æ”¯æŒï¼š
```bash
docker build -t id-allocation-system .
docker run -p 3000:3000 -v $(pwd)/data:/app/data id-allocation-system
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
npm run build
npm start
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- Next.js å›¢é˜Ÿæä¾›ä¼˜ç§€çš„æ¡†æ¶
- better-sqlite3 æä¾›å¯é çš„ SQLite æ”¯æŒ
- Tailwind CSS æä¾›å¿«é€Ÿæ ·å¼å¼€å‘

---

**âš ï¸ å®‰å…¨æç¤º**:
- è¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  `root123`
- å®šæœŸå¤‡ä»½ `data/employee_ids.db` æ•°æ®åº“æ–‡ä»¶
- ä¸è¦å°†ç®¡ç†å‘˜ä¼šè¯ ID æ³„éœ²ç»™ä»–äºº
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS